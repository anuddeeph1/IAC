name: cloud hosted web application using terraform
run-name: ${{ github.actor }} has triggered Scan Action 🚀
on:
  pull_request:
    branches:
      - "main"
  push:
    branches:
      - "main"
permissions:
  contents: read

env:
  AWS_ACCESS_KEY_ID: ${{secrets.AWS_ACCESS_KEY_ID}}
  AWS_SECRET_ACCESS_KEY: ${{secrets.AWS_SECRET_ACCESS_KEY}}
  AWS_SESSION_TOKEN: ${{secrets.AWS_SESSION_TOKEN}}

jobs:
  Terraform-code-scan:
    runs-on: ubuntu-latest
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."

      - name: Check out repository code
        uses: actions/checkout@v4

      - name: Install Terraform
        run: |
          echo "🍏 Installing Terraform..."
          wget https://releases.hashicorp.com/terraform/1.10.5/terraform_1.10.5_linux_amd64.zip
          unzip terraform_1.10.5_linux_amd64.zip
          sudo mv terraform /usr/local/bin/
          echo "Terraform installed successfully."

      - name: Check terraform version
        run: terraform version

      - name: Run Terraform commands
        run: |
          cd config-files/terraform/eks
          echo "Running Terraform commands..."
          terraform init

          #terraform plan -out tfplan.binary
          #terraform show -json tfplan.binary | jq > payload.json
          echo "Terraform commands executed successfully."
    
      - run: echo "🍏 This job's status is ${{ job.status }}."
